<h1>All Statuses</h1>

<table>
  <thead>
    <tr>
      <th>GitHub PR Link</th>
      <th>Date</th>
      <th>Employee</th>
      <th>Remarks</th>
      <th colspan="3">Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @statuses.each do |status| %>
      <tr>
        <td><%= link_to status.github_pr_link, status.github_pr_link %></td>
        <td><%= status.date.strftime('%d-%m-%Y %p') %></td>
        <td><%= status.user ? status.user.name : 'User not available' %></td>
        <td>
          <% remarks = @remarks.select { |remark| remark.status_id == status.id } %>
            <% remarks.each do |remark| %>
            <p><%= remark.content %></p>
          <% end %>
        </td>
        <td><%= link_to 'Show', status %></td>
        <td><%= link_to 'Edit', edit_status_path(status) %></td>
        <td><%= link_to 'Destroy', status, data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} %></td>
        <td>
          <% if current_user.admin? && status.status == "Resolved" %>
            <%= link_to 'Set as Completed', complete_status_path(status), method: :patch %>
          <% elsif current_user.employee? && status.status == "Pending" %>
            <%= link_to 'Resolve', resolve_status_status_path(status), method: :patch %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
<br>
<%= link_to 'New Status', new_status_path %>
